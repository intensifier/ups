# $Id$

# -----------------------------------------------------------------------------
#  Makefile for ups test programs  -  C++ and Fortran tests
#  @configure_input@
# -----------------------------------------------------------------------------

SHELL		= /bin/sh
@SET_MAKE@

srcdir		= @srcdir@
topdir		= @top_srcdir@
VPATH		= @srcdir@
S		= ${srcdir}/

CC		= @CC@
CXX		= @CXX@
F77		= @F77@

# The directory where X include files live.
X11_INC		= @X_CFLAGS@

# X libraries
X11_LIB		= @X_LIBS@  @X_PRE_LIBS@  -lX11  @X_EXTRA_LIBS@

CPPFLAGS	= @CPPFLAGS@  @DEFS@  -I.  -I..  ${X11_INC}
FPPFLAGS	= @FPPFLAGS@  @DEFS@  -I.  -I..  ${X11_INC}
CFLAGS		= @CFLAGS@  ${CPPFLAGS}
FFLAGS		= @CFLAGS@
CXXFLAGS	= @CXXFLAGS@
LDFLAGS		= @LDFLAGS@  ${X11_LIB}  @LIBS@
LIBS		= @LIBS@

SHOWDEFS	= -dM
# -----------------------------------------------------------------------------

CXXBINARIES	= Templates3
CXXSRC		= Templates3.cc

FBINARIES	= test1_f  pippo2 \
		  test2_c test2_f \
		  g77-u77-test
FSRC		= test1_f.f  pippo2.f \
		  test2_c.c test2_main.F test2_sub.F test2_foo.c \
		  g77-u77-test.f

DWBINARIES	= dwf-stabs dwf-dwarf
DWSRC		= dwf1.c dwf2.c

HDRS		= Templates3x.h Templates3x.cc

# -----------------------------------------------------------------------------

default_target:

cxx: ${CXXBINARIES}

fortran: ${FBINARIES}

dwarf: ${DWBINARIES}

all: cxx fortran dwarf

UPS_CFLAGS	= ${CFLAGS} ${UPS_HEADERS}
UPS_CXXFLAGS	= ${CXXFLAGS} ${UPS_HEADERS}
UPS_F77FLAGS	= ${FFLAGS} ${UPS_HEADERS}

CCLINE		= ${CC}  -c ${UPS_CFLAGS}   $S
CXXLINE		= ${CXX} -c ${UPS_CXXFLAGS} $S
F77LINE		= ${F77} ${FPPFLAGS} -c ${UPS_F77FLAGS} $S

LINKCC		= ${CC}
LINKCXX		= ${CXX}
LINKF77		= ${F77}

LINKFLAGS	= ${LDFLAGS} ${X11_LIB} ${LIBS}

LINKCFLAGS	= ${UPS_CFLAGS}
LINKCXXFLAGS	= ${UPS_CXXFLAGS}
LINKF77FLAGS	= ${UPS_F77FLAGS}

ALL_SRC		= ${CXXSRC} ${FSRC} ${HDRS}
FILES		= ${ALL_SRC}

# -----------------------------------------------------------------------------

Templates3.o: Templates3.cc Templates3x.cc Templates3x.h
	${CXXLINE}Templates3.cc

Templates3: Templates3.o
	${LINKCXX} ${LINKCXXFLAGS} -o $@ Templates3.o

# -----------------------------------------------------------------------------

g77-u77-test.o: g77-u77-test.f
	${F77LINE}g77-u77-test.f

g77-u77-test: g77-u77-test.o
	${LINKF77} ${LINKF77FLAGS} -o $@ g77-u77-test.o

pippo2.o: pippo2.f
	${F77LINE}pippo2.f

pippo2: pippo2.o
	${LINKF77} ${LINKF77FLAGS} -o $@ pippo2.o

test1_f.o: test1_f.f
	${F77LINE}test1_f.f

test1_f: test1_f.o
	${LINKF77} ${LINKF77FLAGS} -o $@ test1_f.o

test2_main.o: test2_main.F
	${F77LINE}test2_main.F

test2_sub.o: test2_sub.F
	${F77LINE}test2_sub.F

test2_c.o: test2_c.c
	${CCLINE}test2_c.c

test2_foo.o: test2_foo.c
	${CCLINE}test2_foo.c

test2_c: test2_c.o test2_sub.o test2_foo.o
	${LINKF77} ${LINKF77FLAGS} -o $@ \
		test2_c.o test2_sub.o test2_foo.o

test2_f: test2_main.o test2_sub.o test2_foo.o
	${LINKF77} ${LINKF77FLAGS} -o $@ \
		test2_main.o test2_sub.o test2_foo.o

test5.o: test5.f
	${F77LINE}test5.f

test5: test5.o
	${LINKF77} ${LINKF77FLAGS} -o $@ test5.o

# -----------------------------------------------------------------------------

# Use something like
#	CC=gcc31 F77=g77-31 CXX=g++31 make dwarf

dwf1-stabs.o: dwf1.c
	${CC} -c -I.. $Sdwf1.c -gstabs -o $@

dwf2-stabs.o: dwf2.c
	${CC} -c -I.. $Sdwf2.c -gstabs -o $@

dwf-stabs: dwf1-stabs.o dwf2-stabs.o
	${LINKCC} -gstabs -o $@ dwf1-stabs.o dwf2-stabs.o

# The GCC option for DWARF 2 is '-gdwarf-2'

dwf1-dwarf.o: dwf1.c
	${CC} -c -I.. $Sdwf1.c -gdwarf-2 -o $@

dwf2-dwarf.o: dwf2.c
	${CC} -c -I.. $Sdwf2.c -gdwarf-2 -o $@

dwf-dwarf: dwf1-dwarf.o dwf2-dwarf.o
	${LINKCC} -gdwarf-2 -o $@ dwf1-dwarf.o dwf2-dwarf.o

# -----------------------------------------------------------------------------

clean:
	rm -f ${FBINARIES} ${CXXBINARIES} ${DWBINARIES} *.o *.core core

# -----------------------------------------------------------------------------
#  Header dependenices
# -----------------------------------------------------------------------------
# .o header dependencies, generated by make deps
